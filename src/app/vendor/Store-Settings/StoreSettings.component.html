<div class="store-settings-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>store</mat-icon>
        Store Settings & Dashboard
      </h1>
      <p class="page-subtitle">Manage your store, products, and orders from one central location</p>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>inventory</mat-icon>
          </div>
          <div class="stat-details">
            <h3>{{ storeStats.totalProducts }}</h3>
            <p>Total Products</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>shopping_cart</mat-icon>
          </div>
          <div class="stat-details">
            <h3>{{ storeStats.totalOrders }}</h3>
            <p>Total Orders</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>attach_money</mat-icon>
          </div>
          <div class="stat-details">
            <h3>${{ storeStats.totalRevenue.toLocaleString() }}</h3>
            <p>Total Revenue</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>pending</mat-icon>
          </div>
          <div class="stat-details">
            <h3>{{ storeStats.pendingOrders }}</h3>
            <p>Pending Orders</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Main Content Tabs -->
  <mat-card class="main-content-card">
    <mat-tab-group [(selectedIndex)]="selectedTab" animationDuration="300ms">
      
      <!-- Dashboard Tab -->
      <mat-tab label="Dashboard">
        <div class="tab-content">
          <div class="dashboard-grid">
            
            <!-- Recent Orders -->
            <mat-card class="dashboard-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>receipt</mat-icon>
                  Recent Orders
                </mat-card-title>
                <mat-card-subtitle>Latest customer orders</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content style="max-height: 400px; overflow-y: auto;">
                <mat-list>
                  <mat-list-item *ngFor="let order of recentOrders" class="order-item" (click)="openOrderDetails(order)" style="cursor:pointer;">
                    <div class="order-info">
                      <div class="order-header">
                        <span class="order-id">{{ order.storeName }}</span>
                        <span class="badge ms-2" [ngClass]="getOrderStatusBadgeClass(order.status)">{{ order.status }}</span>
                      </div>
                      <div class="order-details d-flex align-items-center">
                        <span class="customer-name me-3">{{ order.clientName }}</span>
                        <span class="order-amount">${{ order.subTotal }}</span>
                      </div>
                      <div class="order-date">{{ order.orderDate }}</div>
                    </div>
                  </mat-list-item>
                </mat-list>
              </mat-card-content>
            </mat-card>

            <!-- Low Stock Alert -->
            <mat-card class="dashboard-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>warning</mat-icon>
                  Low Stock Alert
                </mat-card-title>
                <mat-card-subtitle>Products running low on inventory</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <mat-list>
                  <mat-list-item *ngFor="let product of lowStockProducts" class="stock-item">
                    <div class="stock-info">
                      <div class="product-name">{{ product.name }}</div>
                      <div class="stock-details">
                        <span class="stock-count">Stock: {{ product.stock }}</span>
                        <mat-chip [color]="getStockColor(product.stock, product.threshold)" selected>
                          {{ getStockStatus(product.stock, product.threshold) }}
                        </mat-chip>
                      </div>
                    </div>
                  </mat-list-item>
                </mat-list>
                <div class="view-all">
                  <button mat-button color="primary">
                    Manage Inventory
                    <mat-icon>arrow_forward</mat-icon>
                  </button>
                </div>
              </mat-card-content>
            </mat-card>

            <!-- Quick Actions -->
            <mat-card class="dashboard-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>flash_on</mat-icon>
                  Quick Actions
                </mat-card-title>
                <mat-card-subtitle>Common tasks and shortcuts</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div *ngIf="!showAddProductModal && !showAddCategoryModal" class="quick-actions">
                  <button mat-raised-button color="primary" class="action-btn" (click)="toggleAddProductModal()">
                    <mat-icon>add</mat-icon>
                    Add Product
                  </button>
                  <button mat-raised-button color="accent" class="action-btn" (click)="toggleAddCategoryModal()">
                    <mat-icon>category</mat-icon>
                    Add Category
                  </button>
                  <button mat-raised-button color="warn" class="action-btn">
                    <mat-icon>inventory</mat-icon>
                    Manage Stock
                  </button>
                  <button mat-raised-button class="action-btn">
                    <mat-icon>analytics</mat-icon>
                    View Reports
                  </button>
                </div>

                <!-- Add Product Form (inline) -->
                <form *ngIf="showAddProductModal" (ngSubmit)="submitAddProduct()" #addProductForm="ngForm" class="add-product-form">
                  <h5>Add Product</h5>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Name</mat-label><input matInput [(ngModel)]="addProductData.name" name="name" required /></mat-form-field>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Description</mat-label><input matInput [(ngModel)]="addProductData.description" name="description" required /></mat-form-field>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Brand</mat-label><input matInput [(ngModel)]="addProductData.brand" name="brand" /></mat-form-field>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>SKU</mat-label><input matInput [(ngModel)]="addProductData.sku" name="sku" /></mat-form-field>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Price</mat-label><input matInput type="number" [(ngModel)]="addProductData.price" name="price" required /></mat-form-field>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Discount</mat-label><input matInput type="number" [(ngModel)]="addProductData.discount" name="discount" /></mat-form-field>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Stock</mat-label><input matInput type="number" [(ngModel)]="addProductData.stock" name="stock" /></mat-form-field>
                  <div class="full-width" style="margin-bottom: 20px;">
                    <label style="display:block; color:#2c3e50; margin-bottom: 6px;">Image</label>
                    <input type="file" (change)="onProductImageChange($event)" />
                  </div>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Product Category ID</mat-label><input matInput type="number" [(ngModel)]="addProductData.productCategoryId" name="productCategoryId" /></mat-form-field>
                  <div class="form-actions">
                    <button mat-button type="button" (click)="closeAddProductModal()">Cancel</button>
                    <button mat-raised-button color="primary" type="submit">Add Product</button>
                  </div>
                </form>

                <!-- Add Product Category Form (inline) -->
                <form *ngIf="showAddCategoryModal" (ngSubmit)="submitAddCategory()" #addCategoryForm="ngForm" class="add-category-form">
                  <h5>Add Product Category</h5>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Name</mat-label><input matInput [(ngModel)]="addCategoryData.name" name="categoryName" required /></mat-form-field>
                  <mat-form-field appearance="outline" class="full-width"><mat-label>Description</mat-label><input matInput [(ngModel)]="addCategoryData.description" name="categoryDescription" required /></mat-form-field>
                  <div class="form-actions">
                    <button mat-button type="button" (click)="closeAddCategoryModal()">Cancel</button>
                    <button mat-raised-button color="accent" type="submit">Add Category</button>
                  </div>
                </form>

              </mat-card-content>
            </mat-card>

          </div>
        </div>
      </mat-tab>

      <!-- Store Settings Tab -->
      <mat-tab label="Store Settings">
        <div class="tab-content">
          <div class="settings-grid">
            
            <!-- Basic Information -->
            <mat-card class="settings-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>store</mat-icon>
                  Basic Information
                </mat-card-title>
                <mat-card-subtitle>Store details and contact information</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <form class="settings-form">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Store Name</mat-label>
                    <input matInput [(ngModel)]="storeSettings.storeName" name="storeName">
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Description</mat-label>
                    <textarea matInput [(ngModel)]="storeSettings.description" name="description" rows="3"></textarea>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Email</mat-label>
                    <input matInput type="email" [(ngModel)]="storeSettings.email" name="email">
                    <mat-icon matSuffix>email</mat-icon>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Phone</mat-label>
                    <input matInput [(ngModel)]="storeSettings.phone" name="phone">
                    <mat-icon matSuffix>phone</mat-icon>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Address</mat-label>
                    <textarea matInput [(ngModel)]="storeSettings.address" name="address" rows="2"></textarea>
                    <mat-icon matSuffix>location_on</mat-icon>
                  </mat-form-field>

                  <div class="form-row">
                    <mat-form-field appearance="outline">
                      <mat-label>Currency</mat-label>
                      <mat-select [(ngModel)]="storeSettings.currency" name="currency">
                        <mat-option value="USD">USD ($)</mat-option>
                        <mat-option value="EUR">EUR (€)</mat-option>
                        <mat-option value="GBP">GBP (£)</mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Timezone</mat-label>
                      <mat-select [(ngModel)]="storeSettings.timezone" name="timezone">
                        <mat-option value="EST">Eastern Time (EST)</mat-option>
                        <mat-option value="PST">Pacific Time (PST)</mat-option>
                        <mat-option value="CST">Central Time (CST)</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </form>
              </mat-card-content>
            </mat-card>

            <!-- Notifications -->
            <mat-card class="settings-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>notifications</mat-icon>
                  Notifications
                </mat-card-title>
                <mat-card-subtitle>Configure notification preferences</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="notification-settings">
                  <div class="setting-item">
                    <div class="setting-info">
                      <h4>Auto Accept Orders</h4>
                      <p>Automatically accept new orders without manual approval</p>
                    </div>
                    <mat-slide-toggle [(ngModel)]="storeSettings.autoAcceptOrders"></mat-slide-toggle>
                  </div>

                  <mat-divider></mat-divider>

                  <div class="setting-item">
                    <div class="setting-info">
                      <h4>Email Notifications</h4>
                      <p>Receive order notifications via email</p>
                    </div>
                    <mat-slide-toggle [(ngModel)]="storeSettings.emailNotifications"></mat-slide-toggle>
                  </div>

                  <mat-divider></mat-divider>

                  <div class="setting-item">
                    <div class="setting-info">
                      <h4>SMS Notifications</h4>
                      <p>Receive order notifications via SMS</p>
                    </div>
                    <mat-slide-toggle [(ngModel)]="storeSettings.smsNotifications"></mat-slide-toggle>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

          </div>

          <!-- Save Button -->
          <div class="save-section">
            <button mat-raised-button color="primary" class="save-btn">
              <mat-icon>save</mat-icon>
              Save Changes
            </button>
          </div>
        </div>
      </mat-tab>

      <!-- Products Tab -->
      <mat-tab label="Products">
        <div class="tab-content">
          <div class="products-header">
            <h2>Product Management</h2>
            <button mat-raised-button color="primary" (click)="toggleAddProductModal()">
              <mat-icon>add</mat-icon>
              Add New Product
            </button>
            <button mat-raised-button color="accent" (click)="toggleAddCategoryModal()">
              <mat-icon>category</mat-icon>
              Add Product Category
            </button>
          </div>
          <p>Product management interface will be implemented here.</p>
        </div>
      </mat-tab>

      <!-- Orders Tab -->
      <mat-tab label="Orders">
        <div class="tab-content">
          <div class="orders-header">
            <h2>Order Management</h2>
            <button mat-raised-button color="accent">
              <mat-icon>refresh</mat-icon>
              Refresh Orders
            </button>
          </div>
          <p>Order management interface will be implemented here.</p>
        </div>
      </mat-tab>

    </mat-tab-group>
  </mat-card>
</div>

<!-- Order Details Modal (moved to root for full-page overlay) -->
<div *ngIf="selectedOrder" class="modal fade show d-block" tabindex="-1" style="background: rgba(0,0,0,0.5); z-index: 1050;">
  <div class="modal-dialog modal-dialog-centered" style="z-index: 1060;">
    <div class="modal-content">
      <div class="modal-header d-flex justify-content-between align-items-center">
        <span class="modal-title">Order #{{ selectedOrder.id }} - {{ selectedOrder.status }}</span>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeOrderDetails()"></button>
      </div>
      <div class="modal-body">
        <h5 class="card-title">{{ selectedOrder.storeName }}</h5>
        <p class="card-text mb-1"><strong>Customer:</strong> {{ selectedOrder.clientName }}</p>
        <p class="card-text mb-1"><strong>Date:</strong> {{ selectedOrder.orderDate }}</p>
        <p class="card-text mb-1">
          <strong>Status:</strong> 
          <span *ngIf="!isEditingStatus" 
                class="badge ms-2" 
                [ngClass]="getOrderStatusBadgeClass(selectedOrder.status)"
                (click)="toggleStatusEdit()"
                style="cursor: pointer;">
            {{ selectedOrder.status }}
          </span>
          <select *ngIf="isEditingStatus" 
                  class="form-select ms-2" 
                  style="width: auto; display: inline-block;"
                  [(ngModel)]="selectedOrder.status">
            <option *ngFor="let status of availableStatuses" [value]="status">{{ status }}</option>
          </select>
        </p>
        <p class="card-text mb-1"><strong>Shipping Address:</strong> {{ selectedOrder.shippingAddress }}</p>
        <p class="card-text mb-1"><strong>Total:</strong> ${{ selectedOrder.subTotal }}</p>
        <div *ngIf="selectedOrder.orderItems && selectedOrder.orderItems.length">
          <hr>
          <h6>Products</h6>
          <ul class="list-group">
            <li class="list-group-item d-flex align-items-center" *ngFor="let item of selectedOrder.orderItems">
              <img [src]="item.productImageUrl" alt="Product" width="48" height="48" class="rounded me-2" style="object-fit:cover;">
              <div class="flex-grow-1">
                <div><strong>{{ item.productName }}</strong></div>
                <div>Qty: {{ item.quantity }} &nbsp; | &nbsp; ${{ item.priceAtTimeOfPurchase }}</div>
              </div>
            </li>
          </ul>
        </div>
        <div *ngIf="isEditingStatus" class="mt-3">
          <button class="btn btn-primary me-2" (click)="updateOrderStatus(selectedOrder.status)">
            <mat-icon>save</mat-icon>
            Save Status
          </button>
          <button class="btn btn-secondary" (click)="toggleStatusEdit()">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade show" (click)="closeOrderDetails()" style="z-index: 1050;"></div>
</div>
